/*
/*This file is part of the 3D Enterprise System Platform. The 3D Enterprise System Platform is free
software: you can redistribute it and/or modify it under the terms of the GNU General Public
License as published by the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.
--
The 3D Enterprise System Platform is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR
A PARTICULAR PURPOSE.  See the GNU General Public License for more details.
--
You should have received a copy of the GNU General Public License
along with the 3D Enterprise System Platform. If not, see <https://www.gnu.org/licenses/>.

Copyright (C) 2023  Blair Kjenner
OVERVIEW
This script sets up all the other subnets for the proof of concept environment.
---------------------------------------
Instructions

*/
select '1. Connect to Postgres ***********************';
/*

SELECT pg_terminate_backend(pg_stat_activity.pid)
FROM pg_stat_activity
WHERE pg_stat_activity.datname like 'sn%'
AND datname != 'sn000000'
AND pid <> pg_backend_pid();

DROP DATABASE if exists sn000011;
CREATE DATABASE sn000011 WITH TEMPLATE sn000010 OWNER postgres;
COMMENT ON DATABASE sn000011 IS 'Municipal District #1';

DROP DATABASE if exists sn000012;
CREATE DATABASE sn000012 WITH TEMPLATE sn000010 OWNER postgres;
COMMENT ON DATABASE sn000012 IS 'Municipal District #2';

DROP DATABASE if exists sn000013;
CREATE DATABASE sn000013 WITH TEMPLATE sn000010 OWNER postgres;
COMMENT ON DATABASE sn000013 IS 'ABC Consulting';

DROP DATABASE if exists sn000014;
CREATE DATABASE sn000014 WITH TEMPLATE sn000010 OWNER postgres;
COMMENT ON DATABASE sn000014 IS 'Bank of Fairfax';

*/
select '2. Connect to sn000010 ***********************';
/*
ALTER DATABASE sn000010 SET search_path TO S0100V0000, S0000V0000, public;
DROP SCHEMA IF EXISTS s0001v0000 CASCADE;
DROP SCHEMA IF EXISTS demodata CASCADE;
DROP SCHEMA IF EXISTS s0106v0000 CASCADE;
DROP SCHEMA IF EXISTS s0107v0000 CASCADE;
DROP SCHEMA IF EXISTS s0110v0000 CASCADE;
DROP SCHEMA IF EXISTS s0120v0000 CASCADE;
*/
select '3. Connect to sn000011 ***********************';
/*
--Run the following script

SET SEARCH_PATH TO PUBLIC;
CREATE EXTENSION IF NOT EXISTS dblink;
-- This needs to be s0001v0000 because we are copying from it.

SET SEARCH_PATH TO s0106v0000, s0000v0000, public;

CALL spsysschemacreate(
        p_systemname := 'Subnet Server sn000011.91',
        p_IsSubnetServer := TRUE,
        p_exSystemID := 91
);

insert into S0091V0000.exsystem
select * from S0106V0000.exsystem where id=106;

ALTER DATABASE sn000011 SET search_path TO S0106V0000, S0000V0000, public;

DROP SCHEMA IF EXISTS demodata CASCADE;
DROP SCHEMA IF EXISTS s0001v0000 CASCADE;
DROP SCHEMA IF EXISTS s0090v0000 CASCADE;
DROP SCHEMA IF EXISTS s0100v0000 CASCADE;
DROP SCHEMA IF EXISTS s0101v0000 CASCADE;
DROP SCHEMA IF EXISTS s0102v0000 CASCADE;
DROP SCHEMA IF EXISTS s0103v0000 CASCADE;
DROP SCHEMA IF EXISTS s0104v0000 CASCADE;
DROP SCHEMA IF EXISTS s0105v0000 CASCADE;
--DROP SCHEMA IF EXISTS s0106v0000 CASCADE;
DROP SCHEMA IF EXISTS s0107v0000 CASCADE;
DROP SCHEMA IF EXISTS s0108v0000 CASCADE;
DROP SCHEMA IF EXISTS s0109v0000 CASCADE;
DROP SCHEMA IF EXISTS s0110v0000 CASCADE;
DROP SCHEMA IF EXISTS s0111v0000 CASCADE;
DROP SCHEMA IF EXISTS s0120v0000 CASCADE;

*/
select '4. Connect to sn000012 ***********************';
/*
--Run the following script

SET SEARCH_PATH TO PUBLIC;
CREATE EXTENSION IF NOT EXISTS dblink;

SET SEARCH_PATH TO s0107v0000, s0000v0000, public;

CALL spsysschemacreate(
        p_systemname := 'Subnet Server sn000011.92',
        p_IsSubnetServer := TRUE,
        p_exSystemID := 92
);

insert into S0092V0000.exsystem
select * from S0107V0000.exsystem where id=107;

ALTER DATABASE sn000012 SET search_path TO S0107V0000, S0000V0000, public;

DROP SCHEMA IF EXISTS demodata CASCADE;
DROP SCHEMA IF EXISTS s0001v0000 CASCADE;
DROP SCHEMA IF EXISTS s0090v0000 CASCADE;
DROP SCHEMA IF EXISTS s0100v0000 CASCADE;
DROP SCHEMA IF EXISTS s0101v0000 CASCADE;
DROP SCHEMA IF EXISTS s0102v0000 CASCADE;
DROP SCHEMA IF EXISTS s0103v0000 CASCADE;
DROP SCHEMA IF EXISTS s0104v0000 CASCADE;
DROP SCHEMA IF EXISTS s0105v0000 CASCADE;
DROP SCHEMA IF EXISTS s0106v0000 CASCADE;
--DROP SCHEMA IF EXISTS s0107v0000 CASCADE;
DROP SCHEMA IF EXISTS s0108v0000 CASCADE;
DROP SCHEMA IF EXISTS s0109v0000 CASCADE;
DROP SCHEMA IF EXISTS s0110v0000 CASCADE;
DROP SCHEMA IF EXISTS s0111v0000 CASCADE;
DROP SCHEMA IF EXISTS s0120v0000 CASCADE;
*/
select '5. Connect to sn000013 ***********************';
/*
 --Run the following script

SET SEARCH_PATH TO PUBLIC;
CREATE EXTENSION IF NOT EXISTS dblink;

SET SEARCH_PATH TO s0110v0000, s0000v0000, public;

CALL spsysschemacreate(
        p_systemname := 'Subnet Server sn000013.93',
        p_IsSubnetServer := TRUE,
        p_exSystemID := 93
);

insert into S0093V0000.exsystem
select * from S0110V0000.exsystem where id=110;

ALTER DATABASE sn000013 SET search_path TO S0110V0000, S0000V0000, public;

DROP SCHEMA IF EXISTS demodata CASCADE;
DROP SCHEMA IF EXISTS s0001v0000 CASCADE;
DROP SCHEMA IF EXISTS s0090v0000 CASCADE;
DROP SCHEMA IF EXISTS s0100v0000 CASCADE;
DROP SCHEMA IF EXISTS s0101v0000 CASCADE;
DROP SCHEMA IF EXISTS s0102v0000 CASCADE;
DROP SCHEMA IF EXISTS s0103v0000 CASCADE;
DROP SCHEMA IF EXISTS s0104v0000 CASCADE;
DROP SCHEMA IF EXISTS s0105v0000 CASCADE;
DROP SCHEMA IF EXISTS s0106v0000 CASCADE;
DROP SCHEMA IF EXISTS s0107v0000 CASCADE;
DROP SCHEMA IF EXISTS s0108v0000 CASCADE;
DROP SCHEMA IF EXISTS s0109v0000 CASCADE;
--DROP SCHEMA IF EXISTS s0110v0000 CASCADE;
DROP SCHEMA IF EXISTS s0111v0000 CASCADE;
DROP SCHEMA IF EXISTS s0120v0000 CASCADE;
*/
select '5. Connect to sn000014 ***********************';
/*
 --Run the following script

SET SEARCH_PATH TO PUBLIC;
CREATE EXTENSION IF NOT EXISTS dblink;

SET SEARCH_PATH TO s0120v0000, s0000v0000, public;

CALL spsysschemacreate(
        p_systemname := 'Subnet Server sn000014.94',
        p_IsSubnetServer := TRUE,
        p_exSystemID := 94
);

insert into S0094V0000.exsystem
select * from S0120V0000.exsystem where id=120;

ALTER DATABASE sn000014 SET search_path TO S0120V0000, S0000V0000, public;

DROP SCHEMA IF EXISTS demodata CASCADE;
DROP SCHEMA IF EXISTS s0001v0000 CASCADE;
DROP SCHEMA IF EXISTS s0090v0000 CASCADE;
DROP SCHEMA IF EXISTS s0100v0000 CASCADE;
DROP SCHEMA IF EXISTS s0101v0000 CASCADE;
DROP SCHEMA IF EXISTS s0102v0000 CASCADE;
DROP SCHEMA IF EXISTS s0103v0000 CASCADE;
DROP SCHEMA IF EXISTS s0104v0000 CASCADE;
DROP SCHEMA IF EXISTS s0105v0000 CASCADE;
DROP SCHEMA IF EXISTS s0106v0000 CASCADE;
DROP SCHEMA IF EXISTS s0107v0000 CASCADE;
DROP SCHEMA IF EXISTS s0108v0000 CASCADE;
DROP SCHEMA IF EXISTS s0109v0000 CASCADE;
DROP SCHEMA IF EXISTS s0110v0000 CASCADE;
DROP SCHEMA IF EXISTS s0111v0000 CASCADE;
--DROP SCHEMA IF EXISTS s0120v0000 CASCADE;
/*
select '6. Connect to Postgres ***********************';

DROP DATABASE IF EXISTS sn000010bak;
CREATE DATABASE sn000010bak WITH TEMPLATE sn000010 OWNER postgres;

DROP DATABASE IF EXISTS sn000011bak;
CREATE DATABASE sn000011bak WITH TEMPLATE sn000011 OWNER postgres;

DROP DATABASE IF EXISTS sn000012bak;
CREATE DATABASE sn000012bak WITH TEMPLATE sn000012 OWNER postgres;

DROP DATABASE IF EXISTS sn000013bak;
CREATE DATABASE sn000013bak WITH TEMPLATE sn000013 OWNER postgres;

DROP DATABASE IF EXISTS sn000014bak;
CREATE DATABASE sn000014bak WITH TEMPLATE sn000014 OWNER postgres;

*/
